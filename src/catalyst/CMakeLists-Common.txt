include(${PARAVIEW_USE_FILE})

include_directories(
    $ENV{WM_PROJECT_DIR}/src/OpenFOAM/lnInclude
    $ENV{WM_PROJECT_DIR}/src/OSspecific/$ENV{WM_OSTYPE}/lnInclude
    $ENV{WM_PROJECT_DIR}/src/finiteArea/lnInclude
    $ENV{WM_PROJECT_DIR}/src/finiteVolume/lnInclude
    $ENV{WM_PROJECT_DIR}/src/fileFormats/lnInclude
    $ENV{WM_PROJECT_DIR}/src/conversion/lnInclude
    $ENV{WM_PROJECT_DIR}/src/meshTools/lnInclude
    $ENV{WM_PROJECT_DIR}/src/lagrangian/basic/lnInclude
    $ENV{WM_PROJECT_DIR}/src/overset/lnInclude
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_BINARY_DIR}
)

link_directories(
    $ENV{FOAM_LIBBIN}
    $ENV{FOAM_LIBBIN}/dummy
)

add_definitions(
    -DWM_$ENV{WM_PRECISION_OPTION} -DWM_LABEL_SIZE=$ENV{WM_LABEL_SIZE}
    -DNoRepository
)

set(CMAKE_BUILD_TYPE Release)

set(CMAKE_CXX_FLAGS_DEBUG
    "-g -O0 -std=c++11 -Wall -Wextra -Wno-unused-parameter -Wnon-virtual-dtor -Wno-overloaded-virtual"
)
set(CMAKE_CXX_FLAGS_RELEASE
    "-O3 -std=c++11 -Wall -Wextra -Wno-unused-parameter -Wnon-virtual-dtor -Wno-overloaded-virtual"
)

# Some characteristics
set(test_file ${CMAKE_CURRENT_BINARY_DIR}/check_initialize.cxx)
file(WRITE ${test_file}
    "#include <vtkCPProcessor.h>\n"
    "int main() {\n"
    "  vtkCPProcessor* p = vtkCPProcessor::New();\n"
    "  p->Initialize(\"AAA\");\n"
    "  p->Delete();\n"
    "  return 0;\n"
    "}"
)
try_compile(CATALYST_HAS_WORKING_DIRECTORY
    ${CMAKE_CURRENT_BINARY_DIR} ${test_file}
    LINK_LIBRARIES vtkPVPythonCatalyst
    CMAKE_FLAGS "-DINCLUDE_DIRECTORIES=${PARAVIEW_INCLUDE_DIRS}"
)
if (CATALYST_HAS_WORKING_DIRECTORY)
    add_definitions(-DUSE_CATALYST_WORKING_DIRECTORY)
else()
    message(WARNING "==== CAUTION: ParaView Catalyst without chdir capability ====")
endif()


set(LIBRARY_OUTPUT_PATH ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}
    CACHE INTERNAL
    ""
)


file(GLOB SOURCE_FILES
    catalystCoprocess.C
    catalystTools.C
    catalystInput.C
    catalystFunctionObject.C

    cloud/catalystCloud.C
    cloud/foamVtkCloudAdaptor.C

    areaMesh/catalystFaMesh.C
    areaMesh/foamVtkFaMeshAdaptor.C
    areaMesh/foamVtkFaMeshAdaptorGeom.C
    areaMesh/foamVtkFaMeshAdaptorFields.C

    volMesh/catalystFvMesh.C
    volMesh/foamVtkFvMeshAdaptor.C
    volMesh/foamVtkFvMeshAdaptorGeom.C
    volMesh/foamVtkFvMeshAdaptorGeomVtu.C
    volMesh/foamVtkFvMeshAdaptorFields.C
)

set(OPENFOAM_LIBRARIES
    OpenFOAM
    Pstream
    finiteArea
    finiteVolume
    fileFormats
    meshTools
    conversion
    lagrangian
    overset
)


if (PARAVIEW_USE_MPI)
    set(LINK_LIBRARIES vtkPVPythonCatalyst vtkParallelMPI)
else()
    set(LINK_LIBRARIES vtkPVPythonCatalyst)
endif()

add_library(
    catalystFoam
    SHARED
    ${SOURCE_FILES}
)

target_link_libraries(
    catalystFoam
    ${LINK_LIBRARIES}
    ${OPENFOAM_LIBRARIES}
)

#-----------------------------------------------------------------------------
